|       |                                            |
| gen00 | hello world example                        |
| gen01 | sdl example                                |
| gen02 | opencv example                             |

- install emsdk
#+begin_example
git clone https://github.com/emscripten-core/emsdk.git
./emsdk install latest
./emsdk activate latest

source "/home/martin/src/emsdk/emsdk_env.sh"

# Configure emsdk in your shell startup scripts by running:
echo 'source "/home/martin/src/emsdk/emsdk_env.sh"' >> $HOME/.bash_profile

#+end_example
- update emsdk
  #+begin_example
# Fetch the latest registry of available tools.
./emsdk update

# Download and install the latest SDK tools.
./emsdk install latest

# Set up the compiler configuration to point to the "latest" SDK.
./emsdk activate latest

# Activate PATH and other environment variables in the current terminal
source ./emsdk_env.sh
  #+end_example
- get a specific emscripten version
  #+begin_example
emsdk list --old
#emsdk install 2.0.34
#emsdk activate 2.0.34
emsdk install 2.0.10
emsdk activate 2.0.10
  #+end_example

- compile opencv with emscripten
#+begin_example
source "/home/martin/src/emsdk/emsdk_env.sh"
cd ~/src
git clone https://github.com/opencv/opencv_contrib
# documentation of how to add (subset of) contrib: https://github.com/opencv/opencv_contrib
cd ~/src
git clone https://github.com/opencv/opencv.git
cd opencv
source "/home/martin/src/emsdk/emsdk_env.sh"
# export EMSCRIPTEN=$EMSDK
ln -s ~/src/opencv/platforms/ /home/martin/src/opencv/build_wasm/./platforms
emcmake python ./platforms/js/build_js.py build_wasm --build_wasm --threads --simd
# this really only works with 2.0.10, i tried 2.0.34 and latest

### next time add this

emcmake python  ./platforms/js/build_js.py build_wasm  --build_wasm \
  --threads --simd --webnn \
  --cmake_option=-DOPENCV_EXTRA_MODULES_PATH=/home/martin/src/opencv_contrib/modules \
  -DBUILD_opencv_legacy=OFF 

#+end_example
- test the opencv in browser
  #+begin_example 
cd /home/martin/src/opencv/build_wasm/bin
python -m http.server

##### this requires --build_test which i have not done
  #+end_example
  
- how to make the build smaller
  - https://lambda-it.ch/blog/build-opencv-js
  - https://github.com/adishavit/party_parrot
  - he writes a c++ program that links with opencv (web assembly) and
    converts colors of an animation
  - inputs and results are transferred between c++ and js in a way
    that minimizes copies
  - printf bit smaller than cout
  - flags to optimize size:
    `-s NO_FILESYSTEM=1 -s ELIMINATE_DUPLICATE_FUNCTIONS=1 -s NO_EXIT_RUNTIME=1`
  - -O3 is downgraded to -O2

- can i write a c++ program that depends on (a small subset of)
  opencv?
  http://videocortex.io/2017/opencv-web-app/

- reading
  - i want to read camera in browser
  - perform aruco detection with opencv in browser

https://emscripten.org/docs/porting/asyncify.html


https://web.dev/fugu-status/
https://www.chromium.org/teams/web-capabilities-fugu/
https://fugu-tracker.web.app/

pan/tilt for camera


http://aggregate.org/DIT/KREMY/ image denoise

http://aggregate.org/DIT/KREMY/noisy220209.pdf
https://learn.sparkfun.com/tutorials/working-with-wire/how-to-use-a-wire-wrap-tool learn wirewrap

8 Color Wrapping Wire AWG30 Cable OK Line PCB Flying Jumper Wire Electrical Wire + WSU Wire Wrap Strip Unwrap Tool BUY (23EUR)


http://earth.google.com/web webassembly based

- https://github.com/serghov/OpencvFaceDetectWasm
  - index.html in /web loads a video in a <video> tag and runs a small
    script that copies each frame of that video onto a canvas, runs
    getImageData on that canvas and passes the resulted pixel array to
    c++.

  - main.cpp in /cpp grabs the pixel array passed by js, wraps it in
    an opencv Mat and runs haar face detection on it. Afterwards the
    image is displayed using emscripten's port of SDL.

- webgl
  - https://emscripten.org/docs/porting/multimedia_and_graphics/OpenGL-support.html#opengl-support
  - To only target WebGL 2 and drop support for WebGL 1 altogether to
    save code size, pass the linker flags -s MIN_WEBGL_VERSION=2 and
    -s MAX_WEBGL_VERSION=2.
- EMSCRIPTEN_GENERATE_BITCODE_STATIC_LIBRARIES sounds interesting
- https://github.com/emscripten-core/emscripten/blob/main/site/source/docs/compiling/Building-Projects.rst

- egl
  - https://emscripten.org/docs/porting/multimedia_and_graphics/EGL-Support-in-Emscripten.html#egl-support-in-emscripten
  - https://github.com/emscripten-core/emscripten/blob/main/tests/third_party/glbook/Common/esUtil.c


- sdl
  - https://github.com/emscripten-core/emscripten/blob/main/tests/hello_world_sdl.cpp
  - Another option is to use Asyncify which will rewrite the program
    so that it can return to the browserâ€™s main event loop by just
    calling emscripten_sleep(). Note that this rewriting causes size
    and speed overhead while emscripten_request_animation_frame_loop /
    emscripten_set_main_loop as described earlier do not.

- example of a face detector
  https://github.com/serghov/OpencvFaceDetectWasm/blob/master/cpp/main.cpp

- imgui in browser
  - https://o-micron.github.io/ScriptenApp/
  - https://github.com/o-micron/ScriptenApp
    - looks like there is no c++ source
  - https://youtu.be/9B1MsXXYhcw
  - https://github.com/o-micron/Prototype
    - this has c++ source

- emscripten examples that only use webgl compatible calls
  - https://github.com/emscripten-core/emscripten/tree/main/tests/third_party/glbook

- single file opengl 3.3 emscripten example
  https://gist.github.com/mortennobel/0e9e90c9bbc61cc99d5c3e9c038d8115

- another example (3 years old)
  https://github.com/pcbaecker/example-emscripten-webgl
#+begin_example

    find_package(OpenGL REQUIRED)

    set(GLFW_BUILD_DOCS OFF CACHE BOOL "" FORCE)
    set(GLFW_BUILD_TESTS OFF CACHE BOOL "" FORCE)
    set(GLFW_BUILD_EXAMPLES OFF CACHE BOOL "" FORCE)
    add_subdirectory(glfw-3.2.1)
add_executable(emscripten_webgl main.cpp)
target_link_libraries(emscripten_webgl glfw ${OPENGL_LIBRARIES})
set_target_properties(emscripten_webgl
        PROPERTIES SUFFIX ".html"
        LINK_FLAGS " --bind -s USE_GLFW=3 -s WASM=1 -g4")
#+end_example

- emscripten docs https://emscripten.org/docs/optimizing/Optimizing-WebGL.html
  - default: WebGL 1 API
    - access with
      #+begin_example
#include <GLES2/gl2.h>
#include <GLES2/gl2ext.h>
      #+end_example
    -  works like GLES 2 with some restrictions
      https://www.khronos.org/registry/webgl/specs/latest/1.0/#6
      - no support of client side rendering, use VBOs instead
    - other alternatives to webl1: webgl2 webgpu
  - On February 9, 2022 Khronos Group announced WebGL 2.0 support for
    all major browsers.
  - WebGL 1.0 is available for mobile Safari, in iOS 8.
  - WebGL 1.0 is available for Android and MeeGo devices since Firefox 4.
  - WebGL 1.0 is available for Android devices since Google Chrome 25
    and enabled by default since version 30

- dear imgui example
  http://www.dearimgui.org/webdemo/master/example_emscripten.html
  - works in safari on ios (but is quite difficult to use, too small
    text, no zoom with pinch)

- is there a minimal version to get an opengl window with emscripten?
  - https://groups.google.com/g/emscripten-discuss/c/DrRfNzloqWc
    - glut and EGL have overhead
    - just call Browser.createContext
  - minimal gui sokol https://github.com/floooh/sokol
  - https://github.com/floooh/cimgui-sokol-starterkit
  - a lot of examples https://floooh.github.io/sokol-html5/
    - data https://github.com/floooh/sokol-html5
      - triangle 52kB
      - imgui-dock-sapp 983kB
	- moving window in safari/ios doesn't work well
      - cimgui-sapp 884kB
      - sgl-microui-sapp 125kB
	- no interaction on safari/ios at all
      - nuklear 350kB maybe another 600kbB file
	- interaction on safari/ios as bad as imgui-dock
    - low-level platform-abstraction     parts of oryol (old)
    - gfx .. supports glcore33 gles2 gles3 d3d11 metal wgpu backends
       - gles2/webgl is lead api
       - wasm is lead platform
       - buffer, image, shader, pipeline, pass
       - sg_draw_state, sg_pass_action, uniform blocks
    - app .. single window
      - https://floooh.github.io/2017/07/29/sokol-gfx-tour.html
    - audio .. webAudio
- imgui-app
  -  https://github.com/pplux/imgui-app/blob/main/example/test.cpp
  - amalgamation of imgui and sokol
    - based on sqlite amalgamation idea
      https://www.sqlite.org/amalgamation.html
